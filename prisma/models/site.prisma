model Click {
  id String @id @default(cuid())

  part    String?
  path    String?
  request Json?

  createdAt DateTime @default(now())

  block     Block?  @relation(fields: [blockId], references: [id])
  blockId   String?
  site      Site?   @relation(fields: [siteId], references: [id])
  siteId    String?
  link      Link?   @relation(fields: [linkId], references: [id])
  linkId    String?
  user      User?   @relation("ClickUser", fields: [userId], references: [id])
  userId    String?
  referer   User?   @relation("ClickReferer", fields: [refererId], references: [id])
  refererId String?

  @@index([createdAt])
  @@index([siteId])
  @@index([linkId])
  @@index([blockId])
  @@index([userId])
  @@index([refererId])
  @@index([siteId, createdAt])
}

model Link {
  id String @id

  url         String
  name        String?
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  clicks Click[]
  user   User?   @relation(fields: [userId], references: [id])
  userId String?

  @@index([userId])
  @@index([createdAt])
  @@index([url])
  @@index([userId, id])
}

model Block {
  id String @id @default(cuid())

  type     String
  position Int     @default(0)
  label    String?
  href     String?
  logo     String?
  style    Json?   @default("{\"hover\": {\"color\": \"#000000\",\"backgroundColor\": \"#ffffff\",\"fontSize\": \"16\",\"fontFamily\": \"Open Sans\"},\"normal\": {\"color\": \"#ffffffe6\",\"backgroundColor\": \"#00000000\",\"fontSize\": \"16\",\"fontFamily\": \"Open Sans\"}}")
  widget   Json?   @default("{}")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  clicks       Click[]
  reservations Reservation[]
  site         Site          @relation(fields: [siteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  siteId       String

  @@index([siteId])
  @@index([type])
  @@index([position])
  @@index([siteId, type])
}

model Like {
  id String @id @default(cuid())

  ip String

  createdAt DateTime @default(now())

  site   Site    @relation(fields: [siteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  siteId String
  user   User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String?
  feed   Feed?   @relation(fields: [feedId], references: [id])
  feedId String?

  @@index([userId])
  @@index([siteId])
  @@index([ip])
  @@index([siteId, ip])
}

model Site {
  id String @id @default(cuid())

  name          String?
  display_name  String?
  description   String?
  logo          String? @default("https://qards.link/rsz_noir-fon-transparent.png")
  font          String  @default("font-cal")
  image         String? @default("https://qards.link/site-default.png")
  imageBlurhash String? @default("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAhCAYAAACbffiEAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR4nN3XyZLDIAwE0Pz/v3q3r55JDlSBplsIEI49h76k4opexCK/juP4eXjOT149f2Tf9ySPgcjCc7kdpBTgDPKByKK2bTPFEdMO0RDrusJ0wLRBGCIuelmWJAjkgPGDSIQEMBDCfA2CEPM80+Qwl0JkNxBimiaYGOTUlXYI60YoehzHJDEm7kxjV3whOQTD3AaCuhGKHoYhyb+CBMwjIAFz647kTqyapdV4enGINuDJMSScPmijSwjCaHeLcT77C7EC0C1ugaCTi2HYfAZANgj6Z9A8xY5eiYghDMNQBJNCWhASot0jGsSCUiHWZcSGQjaWWCDaGMOWnsCcn2QhVkRuxqqNxMSdUSElCDbp1hbNOsa6Ugxh7xXauF4DyM1m5BLtCylBXgaxvPXVwEoOBjeIFVODtW74oj1yBQah3E8tyz3SkpolKS9Geo9YMD1QJR1Go4oJkgO1pgbNZq0AOUPChyjvh7vlXaQa+X1UXwKxgHokB2XPxbX+AnijwIU4ahazAAAAAElFTkSuQmCC")
  subdomain     String? @unique
  customDomain  String? @unique
  message404    String? @default("Blimey! You've found a page that doesn't exist.")
  background    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId      String
  blocks      Block[]
  clicks      Click[]
  subscribers Subscriber[]
  likes       Like[]
  feed        Feed[]

  @@index([userId])
  @@index([userId, createdAt])
  @@index([userId, updatedAt])
}

model Subscriber {
  id String @id @default(cuid())

  email String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  site   Site   @relation(fields: [siteId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  siteId String

  @@index([siteId])
  @@index([email])
  @@index([siteId, email])
}

model Reservation {
  id String @id @default(cuid())

  type String?

  name      String?
  email     String
  dateStart DateTime
  dateEnd   DateTime?
  comment   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  block   Block?  @relation(fields: [blockId], references: [id])
  blockId String?

  affiliate   User?   @relation(fields: [affiliateId], references: [id])
  affiliateId String?

  @@index([dateStart])
  @@index([dateEnd])
  @@index([blockId])
  @@index([email])
  @@index([blockId, email])
}
